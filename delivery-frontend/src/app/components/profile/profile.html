<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      
      <div class="card border-0 shadow-sm mb-4 overflow-hidden">
        <div class="bg-primary p-4 text-white position-relative">
          <div class="d-flex align-items-center flex-column flex-md-row text-center text-md-start">
            <div class="avatar-circle bg-white text-primary fw-bold display-4 shadow mb-3 mb-md-0 me-md-4 d-flex align-items-center justify-content-center" 
                 style="width: 100px; height: 100px; border-radius: 50%;">
              {{ usuario?.nombreCompleto?.charAt(0) || 'U' }}
            </div>
            <div class="flex-grow-1">
              <h3 class="fw-bold mb-1">{{ usuario?.nombreCompleto }}</h3>
              <p class="mb-1 opacity-75">{{ usuario?.correo }}</p>
              <div class="d-flex align-items-center justify-content-center justify-content-md-start gap-2">
                <span class="badge bg-white text-primary rounded-pill px-3">Estudiante</span>
                <span class="badge border border-white text-white rounded-pill px-3">Activo</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card border-0 shadow-lg mb-4 membership-card">
        <div class="card-body p-4 d-flex flex-column justify-content-between position-relative z-1">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h6 class="opacity-75 text-uppercase letter-spacing-2 mb-1">Nivel de Fidelidad</h6>
              <h2 class="fw-bold mb-0 text-white"><i class="fa-solid fa-medal me-2"></i>{{ nombreNivel }}</h2>
            </div>
            <div class="text-end">
              <i class="fa-brands fa-cc-visa fa-3x opacity-50 text-white"></i>
            </div>
          </div>
          <div class="mt-4">
            <div class="d-flex justify-content-between text-small mb-2 text-white">
              <span>XP Actual: <strong>{{ puntosXP }}</strong></span>
              <span>Siguiente: <strong>{{ siguienteNivel }}</strong></span>
            </div>
            <div class="progress" style="height: 8px; background-color: rgba(255,255,255,0.2);">
              <div class="progress-bar bg-warning" role="progressbar" [style.width]="porcentajeProgreso + '%'"></div>
            </div>
            <small class="mt-2 d-block opacity-75 text-white">
              Te faltan {{ xpParaSiguiente - puntosXP }} XP para subir de nivel.
            </small>
          </div>
        </div>
      </div>

      <div class="row g-3 mb-4">
        <div class="col-md-6">
          <div class="card border-0 shadow-sm stat-card h-100">
            <div class="card-body p-3 d-flex align-items-center">
              <div class="bg-light-primary text-primary rounded-circle p-3 me-3">
                <i class="fa-solid fa-receipt fa-xl"></i>
              </div>
              <div>
                <h3 class="fw-bold mb-0">{{ totalPedidos }}</h3>
                <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Pedidos Totales</small>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card border-0 shadow-sm stat-card h-100">
            <div class="card-body p-3 d-flex align-items-center">
              <div class="bg-light-success text-success rounded-circle p-3 me-3">
                <i class="fa-solid fa-utensils fa-xl"></i>
              </div>
              <div>
                <h3 class="fw-bold mb-0">{{ totalProductosComprados }}</h3>
                <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Platos Probados</small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card border-0 shadow-sm mb-4 bg-white" *ngIf="productoFavorito">
        <div class="card-body p-4">
          <div class="row align-items-center">
            <div class="col-md-8">
              <h5 class="fw-bold text-dark mb-1">
                <i class="fa-solid fa-heart text-danger me-2"></i>Tu Obsesión Culinaria
              </h5>
              <p class="text-muted mb-0 small">
                No puedes vivir sin <strong>{{ productoFavorito.nombre }}</strong>. 
                Lo has pedido <span class="badge bg-primary rounded-pill">{{ productoFavorito.count }} veces</span>.
              </p>
            </div>
            <div class="col-md-4 text-center mt-3 mt-md-0">
               <img [src]="productoFavorito.img || 'https://cdn-icons-png.flaticon.com/512/879/879757.png'" 
                   class="rounded-circle border border-4 border-light shadow"
                   style="width: 80px; height: 80px; object-fit: cover;"
                   onerror="this.src='assets/placeholder.jpg'">
            </div>
          </div>
        </div>
      </div>

      <div class="card border-0 shadow-sm mb-5">
        <div class="card-header bg-white py-3 border-bottom">
          <h6 class="mb-0 fw-bold text-dark"><i class="fa-regular fa-id-card me-2 text-primary"></i>Datos de la Cuenta</h6>
        </div>
        <div class="card-body p-0">
          
          <div class="d-flex align-items-center p-3 border-bottom">
            <div class="bg-light rounded-circle p-3 me-3 text-center" style="width: 50px; height: 50px;">
               <i class="fa-regular fa-user text-primary"></i>
            </div>
            <div>
              <small class="text-muted d-block text-uppercase fw-bold" style="font-size: 0.65rem; letter-spacing: 1px;">Nombre Completo</small>
              <span class="fw-bold text-dark">{{ usuario?.nombreCompleto }}</span>
            </div>
          </div>

          <div class="d-flex align-items-center p-3 border-bottom">
            <div class="bg-light rounded-circle p-3 me-3 text-center" style="width: 50px; height: 50px;">
               <i class="fa-regular fa-envelope text-danger"></i>
            </div>
            <div>
              <small class="text-muted d-block text-uppercase fw-bold" style="font-size: 0.65rem; letter-spacing: 1px;">Correo Institucional</small>
              <span class="fw-bold text-dark">{{ usuario?.correo }}</span>
            </div>
          </div>

          <div class="d-flex align-items-center p-3">
            <div class="bg-light rounded-circle p-3 me-3 text-center" style="width: 50px; height: 50px;">
               <i class="fa-solid fa-hashtag text-info"></i>
            </div>
            <div>
              <small class="text-muted d-block text-uppercase fw-bold" style="font-size: 0.65rem; letter-spacing: 1px;">Código de Estudiante</small>
              <span class="fw-bold text-dark">{{ usuario?.codigoEstudiante || 'No registrado' }}</span>
            </div>
          </div>

        </div>
      </div>

      <div class="text-center mb-5">
        <button class="btn btn-outline-danger px-5 rounded-pill" (click)="logout()">
          <i class="fa-solid fa-power-off me-2"></i>Cerrar Sesión
        </button>
      </div>

    </div>
  </div>
</div>