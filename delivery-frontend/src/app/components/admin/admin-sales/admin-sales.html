<div class="container-fluid p-4">
  <h2 class="mb-4">Historial de Ventas</h2>
  
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <table class="table table-striped table-hover mb-0 align-middle">
        <thead class="table-dark">
          <tr>
            <th>ID Orden</th>
            <th>Fecha</th>
            <th>Usuario</th>
            <th>Ubicación Entrega</th>
            <th>Total</th>
            <th>Detalles</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let venta of ventas">
            <td>{{venta.id}}</td>
            <td>{{venta.fechaOrden | date:'dd/MM/yyyy HH:mm'}}</td>
            <td>{{venta.usuario?.nombreCompleto}}</td>
            <td>Torre {{venta.direccionEntrega.torre}} - {{venta.direccionEntrega.aula}}</td>
            <td class="fw-bold">S/ {{venta.total | number:'1.2-2'}}</td>
            <td>
              <button class="btn btn-info btn-sm text-white" (click)="verDetalles(venta)">Ver Detalles</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="modal d-block" tabindex="-1" *ngIf="ventaSeleccionada" style="background: rgba(0,0,0,0.5)">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Detalles de la Orden #{{ventaSeleccionada.id}}</h5>
          <button type="button" class="btn-close" (click)="cerrarModal()"></button>
        </div>
        <div class="modal-body">
          <p><strong>Usuario:</strong> {{ventaSeleccionada.usuario?.nombreCompleto}}</p>
          <p><strong>Correo:</strong> {{ventaSeleccionada.usuario?.correo}}</p>
          <hr>
          <h6>Items de la Orden:</h6>
          <table class="table table-sm">
            <thead>
              <tr>
                <th>Producto</th>
                <th>Cant.</th>
                <th>P. Unit</th>
                <th>Subtotal</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let det of ventaSeleccionada.detalles">
                <td>{{ det.producto?.nombre || det.oferta?.nombreOferta || 'Ítem Desconocido' }}</td>
                <td>{{det.cantidad}}</td>
                <td>S/ {{det.precioUnitarioAlMomento | number:'1.2-2'}}</td>
                <td>S/ {{ (det.precioUnitarioAlMomento * det.cantidad) | number:'1.2-2' }}</td>
              </tr>
            </tbody>
          </table>
          <div class="text-end fw-bold fs-5">Total: S/ {{ventaSeleccionada.total | number:'1.2-2'}}</div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="cerrarModal()">Cerrar</button>
        </div>
      </div>
    </div>
  </div>
</div>